
;	MSX-C ver 1.20p   (code generator)

	cseg
?37:
	defw	?59999
?59999:
	defb	48,46,48,46,49,0

jcVer@:
	ld	hl,(?37)
	ret

	dseg
?39:	defs	2
?40:	defs	2
?41:	defs	1
?42:	defs	1
?43:	defs	1
?44:	defs	2
?45:	defs	2
?48:	defs	2
?49:	defs	1
?50:	defs	1
	cseg

jcInit:
	ld	(?39),hl
	ld	hl,26
	call	alloc@
	ld	(?40),hl
	ld	hl,(?40)
	ld	a,l
	or	h
	jp	nz,@0
	ld	hl,0
	ret
@0:
	ld	hl,(?40)
	ld	bc,22
	add	hl,bc
	push	hl
	ld	hl,(?39)
	ex	de,hl
	ld	bc,4
	pop	hl
	call	opldir
	ld	hl,(?39)
	inc	hl
	ld	a,(hl)
	or	a
	jp	z,@1
	cp	1
	jp	z,@2
	cp	2
	jp	z,@3
	cp	3
	jp	z,@4
	jp	@5
@1:
	ld	a,101
	ld	(?41),a
	ld	a,106
	ld	(?42),a
	ld	a,(?42)
	rrca
	and	127
	ld	(?43),a
	jp	@6
@2:
	ld	a,48
	ld	(?41),a
	ld	a,51
	ld	(?42),a
	ld	a,(?42)
	rrca
	and	127
	ld	(?43),a
	jp	@6
@3:
	ld	a,22
	ld	(?41),a
	ld	a,25
	ld	(?42),a
	ld	a,(?42)
	rrca
	and	127
	ld	(?43),a
	jp	@6
@4:
	ld	a,8
	ld	(?41),a
	ld	a,11
	ld	(?42),a
	ld	a,(?42)
	rrca
	and	127
	ld	(?43),a
	jp	@6
@5:
	ld	hl,0
	ret
@6:
	ld	a,(?41)
	ld	hl,(?40)
	ld	(hl),a
	ld	a,(?42)
	ld	hl,(?40)
	inc	hl
	ld	(hl),a
	ld	a,(?43)
	ld	hl,(?40)
	inc	hl
	inc	hl
	ld	(hl),a
	ld	hl,(?40)
	ld	bc,22
	add	hl,bc
	ld	a,(hl)
	or	a
	jp	nz,@7
	ld	hl,(?40)
	inc	hl
	inc	hl
	inc	hl
	ld	(hl),254
	ld	hl,(?40)
	inc	hl
	inc	hl
	inc	hl
	inc	hl
	ld	(hl),1
	ld	hl,(?40)
	ld	bc,14
	add	hl,bc
	ld	(hl),253
	ld	hl,(?40)
	ld	bc,15
	add	hl,bc
	ld	(hl),2
	ld	hl,(?40)
	ld	bc,18
	add	hl,bc
	ld	(hl),239
	ld	hl,(?40)
	ld	bc,19
	add	hl,bc
	ld	(hl),16
	jp	@8
@7:
	ld	hl,(?40)
	inc	hl
	inc	hl
	inc	hl
	ld	(hl),251
	ld	hl,(?40)
	inc	hl
	inc	hl
	inc	hl
	inc	hl
	ld	(hl),4
	ld	hl,(?40)
	ld	bc,14
	add	hl,bc
	ld	(hl),247
	ld	hl,(?40)
	ld	bc,15
	add	hl,bc
	ld	(hl),8
	ld	hl,(?40)
	ld	bc,18
	add	hl,bc
	ld	(hl),223
	ld	hl,(?40)
	ld	bc,19
	add	hl,bc
	ld	(hl),32
@8:
	ld	hl,(?40)
	ld	bc,5
	add	hl,bc
	ld	(hl),1
	ld	hl,(?40)
	ld	bc,16
	add	hl,bc
	ld	(hl),2
	ld	hl,(?40)
	ld	bc,17
	add	hl,bc
	ld	(hl),4
	ld	hl,62500
	ld	(?48),hl
	ld	hl,(?48)
	ld	a,l
	ld	(?49),a
	ld	hl,(?48)
	dec	hl
	ld	(?48),hl
	ld	hl,(?48)
	ld	a,h
	ld	(?50),a
	ld	hl,?50
	inc	(hl)
	ld	a,(?49)
	ld	hl,?50
	ld	d,(hl)
	ld	e,a
	ld	hl,(?40)
	ld	bc,6
	add	hl,bc
	ld	(hl),e
	inc	hl
	ld	(hl),d
	ld	hl,250
	ld	(?48),hl
	ld	hl,(?48)
	ld	a,l
	ld	(?49),a
	ld	hl,(?48)
	dec	hl
	ld	(?48),hl
	ld	hl,(?48)
	ld	a,h
	ld	(?50),a
	ld	hl,?50
	inc	(hl)
	ld	a,(?49)
	ld	hl,?50
	ld	d,(hl)
	ld	e,a
	ld	hl,(?40)
	ld	bc,9
	add	hl,bc
	ld	(hl),e
	inc	hl
	ld	(hl),d
	ld	hl,(?40)
	ld	bc,8
	add	hl,bc
	ld	(hl),1
	ld	hl,(?40)
	ld	bc,11
	add	hl,bc
	ld	(hl),1
	ld	hl,(?40)
	ld	bc,20
	add	hl,bc
	ld	(hl),0
	ld	hl,(?40)
	ld	bc,21
	add	hl,bc
	ld	(hl),0
	call	gicini
	ld	hl,(?40)
	call	jcLock
	push	hl
	call	dtrH@
	call	rtsH@
	call	txH@
	pop	hl
	call	jcUnlo
	ld	hl,(?40)
	ret

	dseg
?65:	defs	2
?66:	defs	1
?67:	defs	1
?68:	defs	2
?69:	defs	1
?70:	defs	1
	cseg

jcRxTO:
	ld	a,e
	ld	(?65),hl
	ld	(?66),a
	ld	a,c
	ld	(?67),a
	ld	a,(?66)
	ld	hl,(?65)
	ld	bc,8
	add	hl,bc
	ld	(hl),a
	ld	a,(?67)
	ld	hl,(?65)
	ld	bc,11
	add	hl,bc
	ld	(hl),a
	ld	hl,62500
	ld	(?68),hl
	ld	hl,(?68)
	ld	a,l
	ld	(?69),a
	ld	hl,(?68)
	dec	hl
	ld	(?68),hl
	ld	hl,(?68)
	ld	a,h
	ld	(?70),a
	ld	hl,?70
	inc	(hl)
	ld	a,(?69)
	ld	hl,?70
	ld	d,(hl)
	ld	e,a
	ld	hl,(?65)
	ld	bc,6
	add	hl,bc
	ld	(hl),e
	inc	hl
	ld	(hl),d
	ld	hl,250
	ld	(?68),hl
	ld	hl,(?68)
	ld	a,l
	ld	(?69),a
	ld	hl,(?68)
	dec	hl
	ld	(?68),hl
	ld	hl,(?68)
	ld	a,h
	ld	(?70),a
	ld	hl,?70
	inc	(hl)
	ld	a,(?69)
	ld	hl,?70
	ld	d,(hl)
	ld	e,a
	ld	hl,(?65)
	ld	bc,9
	add	hl,bc
	ld	(hl),e
	inc	hl
	ld	(hl),d
	xor	a
	ret


jcKSTO:
	ld	bc,21
	add	hl,bc
	ld	(hl),e
	xor	a
	ret


jcDel@:
	ld	a,l
	or	h
	jp	z,@9
	call	free@
@9:
	call	gicini
	xor	a
	ret

	dseg
?77:	defs	2
?78:	defs	2
?79:	defs	1
?80:	defs	2
	cseg

jcRxC@:
	ld	(?77),hl
	ex	de,hl
	ld	(?78),hl
	ld	hl,(?77)
	call	jcLock
	ld	(?80),hl
	ld	de,1
	ld	hl,(?78)
	call	z0Rx@
	ld	(?79),a
	ld	hl,(?80)
	call	jcUnlo
	ld	a,(?79)
	ret

	dseg
?84:	defs	2
?85:	defs	2
?86:	defs	1
?87:	defs	2
?88:	defs	2
	cseg

jcRxBu:
	ld	(?84),hl
	ex	de,hl
	ld	(?85),hl
	ld	l,c
	ld	h,b
	ld	(?88),hl
	ld	hl,(?84)
	call	jcLock
	ld	(?87),hl
	ld	hl,(?88)
	ex	de,hl
	ld	hl,(?85)
	call	z0Rx@
	ld	(?86),a
	ld	hl,(?87)
	call	jcUnlo
	ld	a,(?86)
	ret

	dseg
?91:	defs	2
?92:	defs	2
?93:	defs	2
?94:	defs	1
	cseg

jcTxC@:
	ld	(?91),hl
	ex	de,hl
	ld	(?92),hl
	ld	hl,(?91)
	call	jcLock
	ld	(?93),hl
	ld	de,1
	ld	hl,(?92)
	call	z0Tx@
	ld	(?94),a
	ld	hl,(?93)
	call	jcUnlo
	ld	a,(?94)
	ret

	dseg
?98:	defs	2
?99:	defs	2
?100:	defs	2
?101:	defs	2
?102:	defs	1
	cseg

jcTxBu:
	ld	(?98),hl
	ex	de,hl
	ld	(?99),hl
	ld	l,c
	ld	h,b
	ld	(?100),hl
	ld	hl,(?98)
	call	jcLock
	ld	(?101),hl
	ld	hl,(?100)
	ex	de,hl
	ld	hl,(?99)
	call	z0Tx@
	ld	(?102),a
	ld	hl,(?101)
	call	jcUnlo
	ld	a,(?102)
	ret


jcTxS@:
	push	hl
	ex	de,hl
	push	hl
	call	strlen
	ld	c,l
	ld	b,h
	pop	de
	pop	hl
	call	jcTxBu
	ret

?106:
	defb	13
	defb	10
	defb	0
?108:
	defb	13
	defb	0
C@RET@:
	defw	?106
bsspbs:
	defb	8
	defb	32
	defb	8
	defb	0
C@BS@:
	defw	bsspbs

jcRxMi:
	ld	bc,12
	add	hl,bc
	ld	a,(hl)
	inc	hl
	ld	h,(hl)
	ld	l,a
	ret

	dseg
?113:	defs	2
?114:	defs	1
	cseg

jcRTS@:
	ld	a,e
	ld	(?114),a
	call	jcLock
	ld	(?113),hl
	ld	a,(?114)
	or	a
	jp	z,@10
	call	rtsL@
	jp	@11
@10:
	call	rtsH@
@11:
	ld	hl,(?113)
	call	jcUnlo
	ret

	dseg
?116:	defs	2
?117:	defs	1
	cseg

jcCTS@:
	call	jcLock
	ld	(?116),hl
	call	cts@
	ld	(?117),a
	ld	hl,(?116)
	call	jcUnlo
	ld	a,(?117)
	ret

	dseg
?119:	defs	2
?120:	defs	1
	cseg

jcDSR@:
	call	jcLock
	ld	(?119),hl
	call	dsr@
	ld	(?120),a
	ld	hl,(?119)
	call	jcUnlo
	ld	a,(?120)
	ret

	dseg
?123:	defs	2
?124:	defs	1
	cseg

jcDTR@:
	ld	a,e
	ld	(?124),a
	call	jcLock
	ld	(?123),hl
	ld	a,(?124)
	or	a
	jp	z,@12
	call	dtrL@
	jp	@13
@12:
	call	dtrH@
@13:
	ld	hl,(?123)
	call	jcUnlo
	ret


	public	jcVer@
	public	jcInit
	extrn	alloc@
	extrn	opldir
	extrn	gicini
	extrn	jcLock
	extrn	dtrH@
	extrn	rtsH@
	extrn	txH@
	extrn	jcUnlo
	public	jcRxTO
	public	jcKSTO
	public	jcDel@
	extrn	free@
	public	jcRxC@
	extrn	z0Rx@
	public	jcRxBu
	public	jcTxC@
	extrn	z0Tx@
	public	jcTxBu
	public	jcTxS@
	extrn	strlen
	public	C@RET@
	public	bsspbs
	public	C@BS@
	public	jcRxMi
	public	jcRTS@
	extrn	rtsL@
	public	jcCTS@
	extrn	cts@
	public	jcDSR@
	extrn	dsr@
	public	jcDTR@
	extrn	dtrL@

	end
