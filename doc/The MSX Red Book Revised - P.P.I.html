<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>
The MSX Red Book Revised - P.P.I.
</title>

<meta name="description" content="The MSX Red Book Revised">
<meta name="date" content="2005-10-01">
<meta name="author" content="Cyberknight Massao Kawata">
<meta name="section" content="Navigation">

<style type="text/css">
  code {color: #0000C0}
  pre {color: #FF0000}
</style>

<script language="JavaScript">

var NoiseX=new Array();

function setupScripts()
{ if ((document.getElementById || document.all || document.layers) && document.createElement)
  { A=0;
    while (A<18)
    { NoiseX[A]=1;
      A++;
    }

    setTimeout("NoiseGen()",10);
  }
}

function NoiseGen()
{ NoiseX0New=NoiseX[17]^NoiseX[06];

  A=17;
  while (A>0)
  { NoiseX[A]=NoiseX[A-1];
    A--;
  }

  NoiseX[00]=NoiseX0New;

  if (NoiseX[00]) NoiseX00.bgColor="#FF6060"; else NoiseX00.bgColor="#FFFFFF";
  if (NoiseX[01]) NoiseX01.bgColor="#FF6060"; else NoiseX01.bgColor="#FFFFFF";
  if (NoiseX[02]) NoiseX02.bgColor="#FF6060"; else NoiseX02.bgColor="#FFFFFF";
  if (NoiseX[03]) NoiseX03.bgColor="#FF6060"; else NoiseX03.bgColor="#FFFFFF";
  if (NoiseX[04]) NoiseX04.bgColor="#FF6060"; else NoiseX04.bgColor="#FFFFFF";
  if (NoiseX[05]) NoiseX05.bgColor="#FF6060"; else NoiseX05.bgColor="#FFFFFF";
  if (NoiseX[06]) NoiseX06.bgColor="#FF6060"; else NoiseX06.bgColor="#FFFFFF";
  if (NoiseX[07]) NoiseX07.bgColor="#FF6060"; else NoiseX07.bgColor="#FFFFFF";
  if (NoiseX[08]) NoiseX08.bgColor="#FF6060"; else NoiseX08.bgColor="#FFFFFF";
  if (NoiseX[09]) NoiseX09.bgColor="#FF6060"; else NoiseX09.bgColor="#FFFFFF";
  if (NoiseX[10]) NoiseX10.bgColor="#FF6060"; else NoiseX10.bgColor="#FFFFFF";
  if (NoiseX[11]) NoiseX11.bgColor="#FF6060"; else NoiseX11.bgColor="#FFFFFF";
  if (NoiseX[12]) NoiseX12.bgColor="#FF6060"; else NoiseX12.bgColor="#FFFFFF";
  if (NoiseX[13]) NoiseX13.bgColor="#FF6060"; else NoiseX13.bgColor="#FFFFFF";
  if (NoiseX[14]) NoiseX14.bgColor="#FF6060"; else NoiseX14.bgColor="#FFFFFF";
  if (NoiseX[15]) NoiseX15.bgColor="#FF6060"; else NoiseX15.bgColor="#FFFFFF";
  if (NoiseX[16]) NoiseX16.bgColor="#FF6060"; else NoiseX16.bgColor="#FFFFFF";
  if (NoiseX[17]) NoiseX17.bgColor="#FF6060"; else NoiseX17.bgColor="#FFFFFF";

  if (NoiseX[17])
  { XORi0.color="#C00000";
    XORi1.color="#C00000";
    XORi2.color="#C00000";
    XORi3.color="#C00000";
    XORi4.color="#C00000";
    XORi5.color="#C00000";
    XORi6.color="#C00000";
    XORi7.color="#C00000";
    XORi8.color="#C00000";
    XORi9.color="#C00000";
    XORiA.color="#C00000";
    XORiB.color="#C00000";
  }
  else
  { XORi0.color="#C0C0C0";
    XORi1.color="#C0C0C0";
    XORi2.color="#C0C0C0";
    XORi3.color="#C0C0C0";
    XORi4.color="#C0C0C0";
    XORi5.color="#C0C0C0";
    XORi6.color="#C0C0C0";
    XORi7.color="#C0C0C0";
    XORi8.color="#C0C0C0";
    XORi9.color="#C0C0C0";
    XORiA.color="#C0C0C0";
    XORiB.color="#C0C0C0";
  }

  if (NoiseX[6])
    XORj0.color="#C00000";
  else
    XORj0.color="#C0C0C0";

  if (NoiseX[17]^NoiseX[06])
  { XORo0.color="#C00000";
    XORo1.color="#C00000";
    XORo2.color="#C00000";
    XORo3.color="#C00000";
    XORo4.color="#C00000";
    XORo5.color="#C00000";
    XORo6.color="#C00000";
    XORo7.color="#C00000";
    XORo8.color="#C00000";
    XORo9.color="#C00000";
    XORoA.color="#C00000";
    XORoB.color="#C00000";
  }
  else
  { XORo0.color="#C0C0C0";
    XORo1.color="#C0C0C0";
    XORo2.color="#C0C0C0";
    XORo3.color="#C0C0C0";
    XORo4.color="#C0C0C0";
    XORo5.color="#C0C0C0";
    XORo6.color="#C0C0C0";
    XORo7.color="#C0C0C0";
    XORo8.color="#C0C0C0";
    XORo9.color="#C0C0C0";
    XORoA.color="#C0C0C0";
    XORoB.color="#C0C0C0";
  }

  setTimeout("NoiseGen()",500);
}

</script>

</head>

<body onload="setupScripts()">


<br><a name="PSG"></a><h2 align="Center">5. PROGRAMMABLE SOUND GENERATOR</h2><br><br>



<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;As well as controlling three sound channels the 8910 PSG
contains two eight bit data ports, called A and B, through
which it interfaces the joysticks and the cassette input. The
PSG appears to the Z80 as three I/O ports called the Address
Port, the Data Write Port and the Data Read Port.</p>


<br><a name="PSG-Address"></a><h3 align="Left">Address Port (I/O port A0H)</h3><br>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The PSG contains sixteen internal registers which completely
define its operation. A specific register is selected by
writing its number, from 0 to 15, to this port. Once selected,
repeated accesses to that register may be made via the two data
ports.</p>


<br><a name="PSG-Write"></a><h3 align="Left">Data Write Port (I/O port A1H)</h3><br>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;This port is used to write to any register once it has been
selected by the Address Port.</p>



<br><a name="PSG-Read"></a><h3 align="Left">Data Read Port (I/O port A2H)</h3><br>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;This port is used to read any register once it has been
selected by the Address Port.</p>



<br><a name="PSG-Reg"></a><h3 align="Left">PSG Registers</h3><br>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The following table summarizes
all PSG registers:</p>

<table cellspacing="0" cellpadding="4" border="1" style="empty-cells: hide">
  <tbody><tr align="Center"><td colspan="2" style="border-left: none; border-top: none"></td><td colspan="8"><b>Register Bits</b></td></tr>
  <tr align="Center"><td><b>Reg.</b></td><td><b>Function</b></td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr>
  <tr align="Center"><td>R0</td><td rowspan="2">Channel A Period</td><td>pa7</td><td>pa6</td><td>pa5</td><td>pa4</td><td>pa3</td><td>pa2</td><td>pa1</td><td>pa0</td></tr><tr align="Center"><td>R1</td><td>-</td><td>-</td><td>-</td><td>-</td><td>paB</td><td>paA</td><td>pa9</td><td>pa8</td></tr><tr>
  </tr><tr align="Center"><td>R2</td><td rowspan="2">Channel B Period</td><td>pb7</td><td>pb6</td><td>pb5</td><td>pb4</td><td>pb3</td><td>pb2</td><td>pb1</td><td>pb0</td></tr><tr align="Center"><td>R3</td><td>-</td><td>-</td><td>-</td><td>-</td><td>pbB</td><td>pbA</td><td>pb9</td><td>pb8</td></tr><tr>
  </tr><tr align="Center"><td>R4</td><td rowspan="2">Channel C Period</td><td>pc7</td><td>pc6</td><td>pc5</td><td>pc4</td><td>pc3</td><td>pc2</td><td>pc1</td><td>pc0</td></tr><tr align="Center"><td>R5</td><td>-</td><td>-</td><td>-</td><td>-</td><td>pcB</td><td>pcA</td><td>pc9</td><td>pc8</td></tr><tr>
  </tr><tr align="Center"><td>R6</td><td>Noise Tone</td><td>-</td><td>-</td><td>-</td><td>n4</td><td>n3</td><td>n2</td><td>n1</td><td>n0</td></tr><tr>
  </tr><tr align="Center"><td>R7</td><td>/Enable</td><td><font color="#FF0000">Port B Dir.</font></td><td><font color="#FF0000">Port A Dir.</font></td><td>C Noise</td><td>B Noise</td><td>A Noise</td><td>C Tone</td><td>B Tone</td><td>A Tone</td></tr><tr>
  </tr><tr align="Center"><td>R8</td><td>Channel A Volume</td><td>-</td><td>-</td><td>-</td><td>A Mode</td><td>va3</td><td>va2</td><td>va1</td><td>va0</td></tr><tr>
  </tr><tr align="Center"><td>R9</td><td>Channel B Volume</td><td>-</td><td>-</td><td>-</td><td>B Mode</td><td>vb3</td><td>vb2</td><td>vb1</td><td>vb0</td></tr><tr>
  </tr><tr align="Center"><td>R10</td><td>Channel C Volume</td><td>-</td><td>-</td><td>-</td><td>C Mode</td><td>vc3</td><td>vc2</td><td>vc1</td><td>vc0</td></tr><tr>
  </tr><tr align="Center"><td>R11</td><td rowspan="2">Envelope Period</td><td>ep7</td><td>ep6</td><td>ep5</td><td>ep4</td><td>ep3</td><td>ep2</td><td>ep1</td><td>ep0</td></tr><tr align="Center"><td>R12</td><td>epF</td><td>epE</td><td>epD</td><td>epC</td><td>epB</td><td>epA</td><td>ep9</td><td>ep8</td></tr><tr>
  </tr><tr align="Center"><td>R13</td><td>Envelope Wave Shape</td><td>-</td><td>-</td><td>-</td><td>-</td><td>es3</td><td>es2</td><td>es1</td><td>es0</td></tr><tr>
  </tr><tr align="Center"><td>R14</td><td>I/O Port A</td><td>Cas<br>Input</td><td>Kbd<br>Mode</td><td>Joy<br>Trg.B</td><td>Joy<br>Trg.A</td><td>Joy<br>Right</td><td>Joy<br>Left</td><td>Joy<br>Back</td><td>Joy<br>Fwd</td></tr>
  <tr align="Center"><td>R15</td><td>I/O Port B</td><td>Kana<br>LED</td><td>Joy<br>Sel</td><td>Pulse<br>2</td><td>Pulse<br>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
</tbody></table>

<p align="Justify"><font color="#FF0000">Important note</font>:
the PSG registers R14 and R15 can be programmed for input or output.
On MSX, R14 must be ever programmed for input and, R15, for output.
Thus, bit 6 of R7 must <b>ever</b> be set to "0" (input) and, bit 7, to "1" (output).
Programming them otherwise may cause severe damage to the machine,
putting active coupling circuitry connected to R14 and R15 in short-circuit.
More details on <a href="#PSG-Reg7">PSG register 7</a> section.</p>

<br><a name="PSG-Reg0"></a><a name="PSG-Reg1"></a><h4 align="Left">PSG Registers 0 and 1</h4><br>

<a name="Figure2"></a>
<ul>
  <table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse">
    <tbody><tr align="Center"><td width="10%">7</td><td width="10%">6</td><td width="10%">5</td><td width="10%">4</td><td width="10%">3</td><td width="10%">2</td><td width="10%">1</td><td width="10%">0</td><td rowspan="3" width="5%"></td><td width="15%"></td></tr>
    <tr align="Center"><td colspan="8" style="border: 1px solid">Channel A Frequency<br>(LSB)</td><td>R0</td></tr>
    <tr align="Center"><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td colspan="4" style="border: 1px solid">Channel A Frequency<br>(MSB)</td><td>R1</td></tr>
  </tbody></table>
  <p>Figure 2: channel A period control registers.</p>
</ul>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;These two registers are used to define the frequency of the
Tone Generator for Channel A. Variable frequencies are produced
by dividing a fixed master frequency with the number held in
Registers 0 and 1, this number can be in the range 1 to 4095.
Register 0 holds the least significant eight bits and Register
1 the most significant four. The PSG divides an external
1.7897725 MHz frequency by sixteen to produce a Tone Generator
master frequency of 111,861 Hz. The output of the Tone Generator
can therefore range from 111,861 Hz (divide by 1) down to
27.3 Hz (divide by 4095). As an example to produce a middle "A"
(440 Hz) the divider value in Registers 0 and 1 would be 254.</p>


<br><a name="PSG-Reg2"></a><a name="PSG-Reg3"></a><h4 align="Left">PSG Registers 2 and 3</h4><br>

<a name="Figure3"></a>
<ul>
  <table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse">
    <tbody><tr align="Center"><td width="10%">7</td><td width="10%">6</td><td width="10%">5</td><td width="10%">4</td><td width="10%">3</td><td width="10%">2</td><td width="10%">1</td><td width="10%">0</td><td rowspan="3" width="5%"></td><td width="15%"></td></tr>
    <tr align="Center"><td colspan="8" style="border: 1px solid">Channel B Frequency<br>(LSB)</td><td>R2</td></tr>
    <tr align="Center"><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td colspan="4" style="border: 1px solid">Channel B Frequency<br>(MSB)</td><td>R3</td></tr>
  </tbody></table>
  <p>Figure 3: channel B period control registers.</p>
</ul>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;These two registers control the Channel B Tone Generator as
for Channel A.</p>



<br><a name="PSG-Reg4"></a><a name="PSG-Reg5"></a><h4 align="Left">PSG Registers 4 and 5</h4><br>

<a name="Figure4"></a>
<ul>
  <table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse">
    <tbody><tr align="Center"><td width="10%">7</td><td width="10%">6</td><td width="10%">5</td><td width="10%">4</td><td width="10%">3</td><td width="10%">2</td><td width="10%">1</td><td width="10%">0</td><td rowspan="3" width="5%"></td><td width="15%"></td></tr>
    <tr align="Center"><td colspan="8" style="border: 1px solid">Channel C Frequency<br>(LSB)</td><td>R4</td></tr>
    <tr align="Center"><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td colspan="4" style="border: 1px solid">Channel C Frequency<br>(MSB)</td><td>R5</td></tr>
  </tbody></table>
  <p>Figure 4: channel C period control registers.</p>
</ul>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;These two registers control the Channel C Tone Generator as
for Channel A.</p>



<br><a name="PSG-Reg6"></a><h4 align="Left">PSG Register 6</h4><br>

<a name="Figure5"></a>
<ul>
  <table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse" width="75%">
    <tbody><tr align="Center"><td width="12.5%">7</td><td width="12.5%">6</td><td width="12.5%">5</td><td width="12.5%">4</td><td width="12.5%">3</td><td width="12.5%">2</td><td width="12.5%">1</td><td width="12.5%">0</td></tr>
    <tr align="Center"><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td style="border: 1px solid">x</td><td colspan="5" style="border: 1px solid">Noise Frequency</td></tr>
  </tbody></table>
  <p>Figure 5.</p>
</ul>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;In addition to three
square wave Tone Generators the PSG contains a single <b>Noise
Generator</b>. The fundamental frequency of the noise source can
be controlled in a similar fashion to the Tone Generators. The
five least significant bits of Register 6 hold a divider value
from 1 to 31. The Noise Generator master frequency is 111,861Hz
as before, used on a <i>Linear Feedback Shift Register</i> (LFSR)
with the equation:</p>

<a name="Figure6"></a>
<ul>
  <table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse">
    <tbody><tr align="Center">
      <td id="NoiseX17" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">17</td>
      <td id="NoiseX16" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">16</td>
      <td id="NoiseX15" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">15</td>
      <td id="NoiseX14" width="5%" style="border: 1px solid" bgcolor="#FF6060">14</td>
      <td id="NoiseX13" width="5%" style="border: 1px solid" bgcolor="#FF6060">13</td>
      <td id="NoiseX12" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">12</td>
      <td id="NoiseX11" width="5%" style="border: 1px solid" bgcolor="#FF6060">11</td>
      <td id="NoiseX10" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">10</td>
      <td id="NoiseX09" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">9</td>
      <td id="NoiseX08" width="5%" style="border: 1px solid" bgcolor="#FF6060">8</td>
      <td id="NoiseX07" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">7</td>
      <td id="NoiseX06" width="5%" style="border: 1px solid" bgcolor="#FF6060">6</td>
      <td id="NoiseX05" width="5%" style="border: 1px solid" bgcolor="#FF6060">5</td>
      <td id="NoiseX04" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">4</td>
      <td id="NoiseX03" width="5%" style="border: 1px solid" bgcolor="#FF6060">3</td>
      <td id="NoiseX02" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">2</td>
      <td id="NoiseX01" width="5%" style="border: 1px solid" bgcolor="#FFFFFF">1</td>
      <td id="NoiseX00" width="5%" style="border: 1px solid" bgcolor="#FF6060">0</td>
      <td width="5%"><font id="XORoB" color="#C00000">←</font></td>
      <td width="5%"><font id="XORoA" color="#C00000">┐</font></td>
      </tr>
      <tr align="Center"><td><font id="XORi0" color="#C0C0C0">│</font></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td><font id="XORj0" color="#C00000">↓</font></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td><font id="XORo9" color="#C00000">│</font></td></tr>
      <tr align="Center"><td><font id="XORi1" color="#C0C0C0">└</font></td><td><font id="XORi2" color="#C0C0C0">─</font></td><td><font id="XORi3" color="#C0C0C0">─</font></td><td><font id="XORi4" color="#C0C0C0">─</font></td><td><font id="XORi5" color="#C0C0C0">─</font></td><td><font id="XORi6" color="#C0C0C0">─</font></td><td><font id="XORi7" color="#C0C0C0">─</font></td><td><font id="XORi8" color="#C0C0C0">─</font></td><td><font id="XORi9" color="#C0C0C0">─</font></td><td><font id="XORiA" color="#C0C0C0">─</font></td><td><font id="XORiB" color="#C0C0C0">→</font></td><td><font id="XORo0" color="#C00000">⊕</font></td><td><font id="XORo1" color="#C00000">─</font></td><td><font id="XORo2" color="#C00000">─</font></td><td><font id="XORo3" color="#C00000">─</font></td><td><font id="XORo4" color="#C00000">─</font></td><td><font id="XORo5" color="#C00000">─</font></td><td><font id="XORo6" color="#C00000">─</font></td><td><font id="XORo7" color="#C00000">─</font></td><td><font id="XORo8" color="#C00000">┘</font></td></tr>
  </tbody></table>
  <p>Figure 6: PSG Noise Generator block diagram, implementing LFSR function
    X<sup>0</sup>'&nbsp;=&nbsp;X<sup>17</sup>&nbsp;⊕&nbsp;X<sup>6</sup>&nbsp;⊕&nbsp;X<sup>0</sup>.
    Because all registers of the LFSR are set to 1 (one) at start, the X<sup>0</sup> term is supressed
    (X<sup>0</sup>&nbsp;=&nbsp;1, so it would just invert the state of X<sup>0</sup>', and once all registers
    are already inverted at start, it must be removed to assure an initial zero to the pseudo-random sequence).
    The noise output is extracted from register 0.</p>
</ul>


<br><a name="PSG-Reg7"></a><h4 align="Left">PSG Register 7</h4><br>

<a name="Figure7"></a>
<ul>
  <table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse">
    <tbody><tr align="Center"><td width="12.5%">7</td><td width="12.5%">6</td><td width="12.5%">5</td><td width="12.5%">4</td><td width="12.5%">3</td><td width="12.5%">2</td><td width="12.5%">1</td><td width="12.5%">0</td></tr>
    <tr align="Center">
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Port'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Port B Direction</td>
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Port'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Port A Direction</td>
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Noise'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Channel C Noise</td>
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Noise'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Channel B Noise</td>
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Noise'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Channel A Noise</td>
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Tone'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Channel C Tone</td>
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Tone'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Channel B Tone</td>
      <td style="border: 1px solid; cursor:pointer; cursor:hand" onclick="window.location='#Reg7-Tone'" onmouseover="bgColor='#A0D0FF'" onmouseout="bgColor='#FFFFFF'">Channel A Tone</td></tr>
  </tbody></table>
  <p>Figure 7: PSG Control Register 1.</p>
</ul>


<a name="Reg7-Noise"></a><a name="Reg7-Tone"></a>
<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;This register enables
or disables the Tone Generator and Noise Generator for each of
the three channels. Notice that it uses inverse logic, that is,
0=Enable and 1=Disable. Also notice that PSG has three different
tone generators, each attached to its corresponding channel,
but only one noise generator, attached to the three channels
at the same time.</p>

<a name="Figure7"></a>
<ul>
  <table cellspacing="0" cellpadding="4" border="0" style="border-collapse: collapse">
    <tbody><tr>
      <td style="border: 1px solid">Channel A Tone Generator</td><td>&nbsp;</td>
      <td style="border: 1px solid">Channel B Tone Generator</td><td>&nbsp;</td>
      <td style="border: 1px solid">Channel C Tone Generator</td><td>&nbsp;</td>
      <td style="border: 1px solid">Noise Generator</td>
    </tr>
    <tr>
      <td>
    </td></tr>
  </tbody></table>
  <p>Figure 8: PSG mixer.</p>
</ul>


<a name="Reg7-Port"></a>
<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;It also controls the
direction of interface ports A and B, to which the joysticks and
cassette are attached: 0=Input, 1=Output. Register 7 must always
contain 10xxxxxx or
possible damage could result to the PSG, there are active
devices connected to its I/O pins. The BASIC "SOUND" statement
will force these bits to the correct value for Register 7 but
there is no protection at the machine code level.</p>



<br><a name="PSG-Reg8"></a><h4 align="Left">PSG Register 8</h4><br>

<ul><pre>       7     6     5     4     3     2     1     0
    +-----+-----+-----+-----+-----------------------+
    |  x  |  x  |  x  |Mode |  Channel A Amplitude  |
    +-----+-----+-----+-----+-----------------------+
</pre></ul>
<p>Figure 28.</p>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The four Amplitude bits determine the amplitude of Channel A
from a minimum of 0 to a maximum of 15. The Mode bit selects
either fixed or modulated amplitude: 0=Fixed, 1=Modulated. When
modulated amplitude is selected the fixed amplitude value is
ignored and the channel is modulated by the output from the
Envelope Generator.</p>



<br><a name="PSG-Reg9"></a><h4 align="Left">PSG Register 9</h4><br>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;This register controls the amplitude of Channel B as for
Channel A.</p>


<br><a name="PSG-Reg10"></a><h4 align="Left">PSG Register 10</h4><br>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;This register controls the amplitude of Channel C as for
Channel A.</p>


<br><a name="PSG-Reg11"></a><a name="PSG-Reg12"></a><h4 align="Left">PSG Registers 11 and 12</h4><br>

<ul><pre>      7  6  5  4  3  2  1  0
    +------------------------+
    |Envelope Frequency (LSB)| R11
    +------------------------+
    |Envelope Frequency (MSB)| R12
    +------------------------+
</pre></ul>
<p>Figure 29.</p>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;These two registers control the frequency of the single
Envelope Generator used for amplitude modulation. As for the
Tone Generators this frequency is determined by placing a
divider count in the registers. The divider value may range
from 1 to 65535 with Register 11 holding the least significant
eight bits and Register 12 the most significant. The master
frequency for the Envelope Generator is 6991 Hz so the envelope
frequency may range from 6991 Hz (divide by 1) to 0.11 Hz (divide
by 65535).</p>



<br><a name="PSG-Reg13"></a><h4 align="Left">PSG Register 13</h4><br>

<ul><pre>      7   6   5   4   3   2   1   0
    +---+---+---+---+---------------+
    | x | x | x | x |Envelope Shape |
    +---+---+---+---+---------------+
</pre></ul>
<p>Figure 30.</p>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The four Envelope Shape bits determine the shape of the
amplitude modulation envelope produced by the Envelope
Generator:</p>

<ul><pre>    3 2 1 0   Modulation Envelope

    0 0 x x   |\_________________

    0 1 x x   /|_________________

    1 0 0 0   |\|\|\|\|\|\|\|\|\|

    1 0 0 1   |\_________________

    1 0 1 0   \/\/\/\/\/\/\/\/\/\
                _________________
    1 0 1 1   \|

    1 1 0 0   /|/|/|/|/|/|/|/|/|/
               __________________
    1 1 0 1   /

    1 1 1 0   /\/\/\/\/\/\/\/\/\/

    1 1 1 1   /|_________________
</pre></ul>
<p>Figure 31.</p>




<br><a name="PSG-Reg14"></a><h4 align="Left">PSG Register 14</h4><br>

<ul><pre>       7     6     5     4     3     2     1     0
    +-----+-----+-----+-----+-----+-----+-----+-----+
    | Cas | Kbd | Joy | Joy | Joy | Joy | Joy | Joy |
    |Input|Mode |Trg.B|Trg.A|Right|Left |Back | Fwd |
    +-----+-----+-----+-----+-----+-----+-----+-----+
</pre></ul>
<p>Figure 32.</p>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;This register is used to read in PSG Port A. The six
joystick bits reflect the state of the four direction switches
and two trigger buttons on a joystick: 0=Pressed, 1=Not
pressed. Alternatively up to six Paddles may be connected
instead of one joystick. Although most MSX machines have two 9
pin joystick connectors only one can be read at a time. The one
to be selected for reading is determined by the Joystick Select
bit in PSG Register 15.</p>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The Keyboard Mode bit is unused on UK machines. On
Japanese machines it is tied to a jumper link to determine
the keyboard's character set.</p>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The Cassette Input is used to read the signal from the
cassette EAR output. This is passed through a comparator to
clean the edges and to convert to digital levels but is
otherwise unprocessed.</p>



<br><a name="PSG-Reg15"></a><h4 align="Left">PSG Register 15</h4><br>

<ul><pre>       7     6     5     4     3     2     1     0
    +-----+-----+-----+-----+-----+-----+-----+-----+
    |Kana | Joy |Pulse|Pulse|  1  |  1  |  1  |  1  |
    | LED | Sel |  2  |  1  |     |     |     |     |
    +-----+-----+-----+-----+-----+-----+-----+-----+
</pre></ul>
<p>Figure 33.</p>


<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;This register is used to output to PSG Port B. The four
least significant bits are connected via TTL open-collector
buffers to pins 6 and 7 of each joystick connector. They are
normally set to a 1, when a paddle or joystick is connected, so
that the pins can function as inputs. When a touchpad is
connected they are used as handshaking outputs.</p>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The two Pulse bits are used to generate a short positive-
going pulse to any paddles attached to joystick connectors 1 or
2. Each paddle contains a monostable timer with a variable
resistor controlling its pulse length. Once the timer is
triggered the position of the variable resistor can be
determined by counting until the monostable times out.</p>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The Joystick Select bit determines which joystick connector
is connected to PSG Port A for input: 0=Connector 1,
1=Connector 2.</p>

<p align="Justify">&nbsp;&nbsp;&nbsp;&nbsp;The Kana LED output is unused on UK machines. On Japanese
machines it is used to drive a keyboard mode indicator.</p>



<hr>

<p align="Center"><a href="https://www.angelfire.com/art2/unicorndreams/msx/RR-BIOS.html">Go to next chapter: B.I.O.S.</a></p>



</body></html>